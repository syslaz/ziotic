#!/bin/bash

# Database configuration
DB_HOST="127.0.0.1"
DB_USER="alterrs"
DB_PASS="default_password"
DB_NAME="alterrs"

# Connect to MySQL and create tables
mariadb -h $DB_HOST -u $DB_USER -p$DB_PASS $DB_NAME <<EOF
CREATE TABLE IF NOT EXISTS members (
    member_id INT PRIMARY KEY AUTO_INCREMENT,
    members_seo_name VARCHAR(255) NOT NULL,
    members_pass_hash VARCHAR(255) NOT NULL,
    members_pass_salt VARCHAR(255) NOT NULL,
    member_group_id INT NOT NULL,
    email VARCHAR(255),
    msg_count_new INT DEFAULT 0
);

CREATE TABLE IF NOT EXISTS subscription_trans (
    subtrans_id INT PRIMARY KEY AUTO_INCREMENT,
    subtrans_member_id INT NOT NULL,
    subtrans_state VARCHAR(50) NOT NULL,
    subtrans_end_date BIGINT NOT NULL,
    FOREIGN KEY (subtrans_member_id) REFERENCES members(member_id)
);

CREATE TABLE IF NOT EXISTS playersave (
    id INT(9) PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    lastLoggedIn BIGINT(32) DEFAULT 0 NOT NULL,
    lastIPs VARCHAR(64) DEFAULT '0.0.0.0;0.0.0.0;0.0.0.0' NOT NULL,
    x INT(5) DEFAULT -1 NOT NULL,
    y INT(5) DEFAULT -1 NOT NULL,
    z INT(5) DEFAULT -1 NOT NULL,
    runToggled INT(1) DEFAULT 0 NOT NULL,
    runEnergy INT(3) DEFAULT 100 NOT NULL,
    inv VARCHAR(512) DEFAULT '-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1;-1' NOT NULL,
    invN VARCHAR(512) DEFAULT '0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0' NOT NULL,
    equip VARCHAR(256) DEFAULT '0;0;0;0;0;0;0;0;0;0;0;0;0;0' NOT NULL,
    equipN VARCHAR(256) DEFAULT '0;0;0;0;0;0;0;0;0;0;0;0;0;0' NOT NULL,
    bank LONGTEXT DEFAULT NULL,
    bankN LONGTEXT DEFAULT NULL,
    bankT LONGTEXT DEFAULT NULL,
    level VARCHAR(256) DEFAULT '1;1;10;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1;1' NOT NULL,
    exp VARCHAR(1024) DEFAULT '0;0;1154;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0' NOT NULL,
    xpCounter INT(11) DEFAULT 0 NOT NULL,
    autoRetaliate INT(1) DEFAULT 0 NOT NULL,
    attackStyle INT(1) DEFAULT 0 NOT NULL,
    prayerBook INT(1) DEFAULT 1 NOT NULL,
    quickPrayers VARCHAR(256) DEFAULT '0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0' NOT NULL,
    friends VARCHAR(5120) DEFAULT '' NOT NULL,
    ignores VARCHAR(5120) DEFAULT '' NOT NULL,
    pmSetting INT(1) DEFAULT 0 NOT NULL,
    pmColor INT(2) DEFAULT 0 NOT NULL,
    lastClan VARCHAR(16) DEFAULT NULL,
    spellBook INT(3) DEFAULT 193 NOT NULL,
    looks VARCHAR(28) DEFAULT '310;307;443;599;390;646;438' NOT NULL,
    colors VARCHAR(20) DEFAULT '6;40;216;4;0' NOT NULL,
    specialEnergy INT(3) DEFAULT 100 NOT NULL,
    muted INT(1) DEFAULT 0 NOT NULL,
    skulled INT(1) DEFAULT 0 NOT NULL,
    skullTimer INT(4) DEFAULT 0 NOT NULL
);

CREATE TABLE IF NOT EXISTS clans (
    owner VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    enabled BOOLEAN DEFAULT TRUE,
    enterReq INT DEFAULT 0,
    talkReq INT DEFAULT 0,
    kickReq INT DEFAULT 0,
    lootShareReq INT DEFAULT 0,
    recruits TEXT,
    corporals TEXT,
    sergeants TEXT,
    lieutenants TEXT,
    captains TEXT,
    generals TEXT
);

EOF

# # Function to hash a password with salt using MD5
# hash_password() {
# 	PASSWORD=$1
# 	SALT=$2
# 	echo -n "$SALT" | md5sum | awk '{print $1}' >salt_hash.txt
# 	echo -n "$PASSWORD" | md5sum | awk '{print $1}' >password_hash.txt
# 	SALT_HASH=$(cat salt_hash.txt)
# 	PASSWORD_HASH=$(cat password_hash.txt)
# 	echo -n "${SALT_HASH}${PASSWORD_HASH}" | md5sum | awk '{print $1}'
# 	rm salt_hash.txt password_hash.txt
# }
#
# # Register a player
# USERNAME="lazaro"
# PASSWORD="secure_password"
# SALT=$(openssl rand -hex 16)
# PASSWORD_HASH=$(hash_password $PASSWORD $SALT)
#
# mariadb -h $DB_HOST -u $DB_USER -p$DB_PASS $DB_NAME <<EOF
# INSERT INTO members (members_seo_name, members_pass_hash, members_pass_salt, member_group_id, email, msg_count_new)
# VALUES ('$USERNAME', '$PASSWORD_HASH', '$SALT', 1, 'player@example.com', 0);
# EOF
#
# echo "Player $USERNAME registered successfully!"
